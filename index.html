<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delos Host-Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #ff2a00;
      --primary-glow: rgba(255, 42, 0, 0.4);
      --secondary: #ffcc99;
      --tertiary: #4db8ff;
      --bg-dark: #0a0a0a;
      --bg-light: #f0f0f0;
      --text-dark: #ffffff;
      --text-light: #111111;
      --panel-dark: rgba(20, 20, 20, 0.85);
      --panel-light: rgba(255, 255, 255, 0.85);
      --border-radius: 4px;
    }

    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--secondary);
      font-family: 'Roboto Mono', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        repeating-linear-gradient(30deg, rgba(255, 42, 0, 0.03) 0px, transparent 2px, transparent 50px),
        repeating-linear-gradient(150deg, rgba(255, 42, 0, 0.03) 0px, transparent 2px, transparent 50px),
        radial-gradient(circle at 50% 50%, transparent 0%, rgba(0, 0, 0, 0.9) 100%);
      z-index: -1;
    }

    .hexagon-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.1;
      pointer-events: none;
    }

    .hexagon {
      position: absolute;
      width: 30px;
      height: 17.32px; /* width * sqrt(3)/2 */
      background-color: var(--primary);
      margin: 8.66px 0; /* width * sqrt(3)/4 */
      opacity: 0.2;
    }

    .hexagon:before,
    .hexagon:after {
      content: "";
      position: absolute;
      width: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
    }

    .hexagon:before {
      bottom: 100%;
      border-bottom: 8.66px solid var(--primary);
    }

    .hexagon:after {
      top: 100%;
      border-top: 8.66px solid var(--primary);
    }

    .logo {
      text-align: center;
      margin-bottom: 10px;
      font-size: 14px;
      letter-spacing: 2px;
      position: relative;
      padding-bottom: 15px;
      color: var(--primary);
      text-transform: uppercase;
    }

    .logo::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 2px;
      background: var(--primary);
      box-shadow: 0 0 8px var(--primary-glow);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 95%;
      max-width: 1200px;
      margin-bottom: 20px;
    }

    .status-display {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 8px 15px;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      width: 95%;
      max-width: 1200px;
      gap: 20px;
    }

    @media (min-width: 1024px) {
      .main-content {
        flex-direction: row;
      }
    }

    .tab-container {
      width: 100%;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
    }

    .tab {
      padding: 10px 20px;
      margin: 0 5px;
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      cursor: pointer;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.85rem;
      border-radius: var(--border-radius);
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }

    .tab.active {
      background-color: var(--primary);
      color: black;
    }

    .tab:hover:not(.active) {
      background-color: rgba(255, 42, 0, 0.2);
    }

    .panel {
      background: var(--panel-dark);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 0 15px var(--primary-glow), inset 0 0 20px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      flex: 1;
      display: none;
      max-height: 70vh;
      overflow-y: auto;
    }

    .panel.active {
      display: block;
    }

    .section-title {
      color: var(--primary);
      font-weight: 400;
      margin-top: 0;
      font-size: 1.2rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      position: relative;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .section-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 1px;
      background: var(--primary);
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--secondary);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.5);
      color: var(--text-dark);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      font-family: 'Roboto Mono', monospace;
      font-size: 16px;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 8px var(--primary-glow);
    }

    .btn {
      padding: 12px 20px;
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      font-weight: 400;
      cursor: pointer;
      width: 100%;
      border-radius: var(--border-radius);
      font-family: 'Roboto Mono', monospace;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
      font-size: 0.9rem;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .btn.small {
      padding: 8px 15px;
      font-size: 0.8rem;
      margin-bottom: 0;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: var(--primary);
      transition: all 0.4s;
      z-index: -1;
    }

    .btn:hover {
      color: #000;
    }

    .btn:hover::before {
      left: 0;
    }

    .btn.danger {
      border-color: #ff4d4d;
      color: #ff4d4d;
    }

    .btn.danger::before {
      background: #ff4d4d;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .controls button {
      flex: 1 0 48%;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.8);
      color: var(--secondary);
      border-left: 3px solid var(--primary);
      border-radius: var(--border-radius);
      z-index: 1000;
      font-size: 0.85rem;
      transform: translateX(200%);
      transition: transform 0.3s ease;
      max-width: 300px;
    }

    .notification.show {
      transform: translateX(0);
    }

    /* Hologramm-Avatar Styles */
    .holo-avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      border: 2px solid var(--primary);
      box-shadow: 0 0 25px var(--primary-glow), inset 0 0 8px rgba(255,255,255,0.2);
      margin: 0 auto 20px;
      position: relative;
      overflow: hidden;
      animation: pulseGlow 3s infinite ease-in-out;
      background-color: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .holo-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.85;
      filter: brightness(1.1) contrast(1.2);
      transition: all 0.5s ease;
    }

    .holo-avatar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      box-shadow: inset 0 0 15px var(--primary-glow);
      z-index: 2;
      pointer-events: none;
    }

    .scan-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      opacity: 0.8;
      z-index: 3;
      box-shadow: 0 0 8px var(--primary);
      animation: scanAnimation 3s infinite linear;
    }

    .holo-avatar:hover .scan-line {
      animation-duration: 1.5s;
    }

    .holo-avatar:hover::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at center, transparent 30%, rgba(255, 42, 0, 0.1) 70%),
        repeating-radial-gradient(circle at center, transparent 0%, transparent 5%, rgba(255, 42, 0, 0.05) 5.5%);
      animation: matrixScan 2s infinite linear;
      z-index: 1;
    }

    .theme-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--primary);
      color: black;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    /* Host-Liste */
    .host-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .host-card {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 15px;
      position: relative;
      transition: all 0.3s ease;
    }

    .host-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(255, 42, 0, 0.3);
    }

    .host-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
      border-bottom: 1px solid rgba(255, 42, 0, 0.3);
      padding-bottom: 10px;
    }

    .host-name {
      font-size: 1.1rem;
      color: var(--secondary);
      margin: 0;
    }

    .host-status {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 10px;
      text-transform: uppercase;
      background: rgba(0, 0, 0, 0.3);
    }

    .host-status.aktiviert {
      color: #4caf50;
      border: 1px solid #4caf50;
    }

    .host-status.inaktiv {
      color: #ff9800;
      border: 1px solid #ff9800;
    }

    .host-status.diagnostik {
      color: #2196f3;
      border: 1px solid #2196f3;
    }

    .host-status.bulk-apperception {
      color: #e91e63;
      border: 1px solid #e91e63;
    }

    .host-type {
      font-size: 0.8rem;
      color: var(--tertiary);
      margin: 5px 0;
    }

    .host-assignment {
      font-size: 0.85rem;
      margin: 10px 0;
      color: #ddd;
    }

    .host-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      font-size: 0.75rem;
    }

    .host-stat {
      text-align: center;
      flex: 1;
    }

    .stat-value {
      font-size: 1.1rem;
      color: var(--secondary);
      margin-bottom: 2px;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #999;
    }

    .host-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      gap: 10px;
    }

    /* Map styles */
    .map-container {
      height: 400px;
      position: relative;
      margin-top: 20px;
      overflow: hidden;
      border-radius: var(--border-radius);
      border: 1px solid var(--primary);
    }

    .park-map {
      width: 100%;
      height: 100%;
      background-color: #1a1a1a;
      background-image: 
        radial-gradient(circle at 50% 50%, #2a2a2a 0%, #1a1a1a 100%),
        repeating-linear-gradient(0deg, rgba(255, 42, 0, 0.05) 0px, transparent 1px, transparent 30px);
      position: relative;
    }

    .region {
      position: absolute;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 1px;
      overflow: hidden;
    }

    .region:hover {
      border-color: var(--primary);
      color: var(--primary);
      box-shadow: 0 0 10px rgba(255, 42, 0, 0.5);
      z-index: 10;
    }

    .region::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(255, 42, 0, 0.1);
      opacity: 0;
      z-index: -1;
      transition: opacity 0.3s ease;
    }

    .region:hover::after {
      opacity: 1;
    }

    .region.has-hosts::before {
      content: '';
      position: absolute;
      top: 5px;
      right: 5px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: var(--primary);
      animation: pulse 2s infinite;
    }

    .map-tooltip {
      position: absolute;
      display: none;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--primary);
      padding: 10px;
      border-radius: var(--border-radius);
      z-index: 100;
      max-width: 200px;
      font-size: 0.8rem;
    }

    .map-tooltip h4 {
      margin: 0 0 5px 0;
      color: var(--primary);
      font-size: 0.9rem;
    }

    .map-tooltip p {
      margin: 0;
      font-size: 0.75rem;
    }

    /* Narrative panel styles */
    .narrative-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .narrative-card {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 15px;
      position: relative;
      transition: all 0.3s ease;
    }

    .narrative-card:hover {
      box-shadow: 0 5px 15px rgba(255, 42, 0, 0.3);
    }

    .narrative-title {
      font-size: 1rem;
      color: var(--secondary);
      margin: 0 0 10px 0;
      border-bottom: 1px solid rgba(255, 42, 0, 0.3);
      padding-bottom: 5px;
    }

    .narrative-region {
      font-size: 0.8rem;
      color: var(--tertiary);
      margin: 5px 0;
    }

    .narrative-description {
      font-size: 0.8rem;
      margin: 10px 0;
      color: #ddd;
    }

    .host-select {
      margin-top: 10px;
    }

    /* Animation keyframes */
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 15px var(--primary-glow), inset 0 0 10px rgba(255,42,0,0.2); }
      50% { box-shadow: 0 0 25px var(--primary), inset 0 0 15px rgba(255,42,0,0.4); }
    }

    @keyframes scanAnimation {
      0% { top: 0; }
      100% { top: 100%; }
    }

    @keyframes matrixScan {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 0.5; }
      100% { transform: scale(1); opacity: 0.8; }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.5); }
    }

    /* Light theme */
    body.light {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    body.light .panel {
      background: var(--panel-light);
      box-shadow: 0 0 15px rgba(255, 42, 0, 0.2), inset 0 0 20px rgba(255, 255, 255, 0.5);
    }

    body.light input, 
    body.light select,
    body.light textarea {
      background: rgba(255, 255, 255, 0.8);
      color: var(--text-light);
    }

    body.light .host-card,
    body.light .narrative-card {
      background: rgba(255, 255, 255, 0.3);
    }

    body.light .notification {
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-light);
    }

    body.light .park-map {
      background-color: #f2f2f2;
      background-image: 
        radial-gradient(circle at 50% 50%, #ffffff 0%, #f2f2f2 100%),
        repeating-linear-gradient(0deg, rgba(255, 42, 0, 0.05) 0px, transparent 1px, transparent 30px);
    }

    body.light .region {
      color: rgba(0, 0, 0, 0.7);
      border-color: rgba(0, 0, 0, 0.2);
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 10px;
      }
      
      .panel {
        padding: 15px;
        max-height: 70vh;
      }

      .host-list, .narrative-list {
        grid-template-columns: 1fr;
      }

      .tab {
        padding: 8px 12px;
        font-size: 0.75rem;
      }

      .map-container {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="hexagon-bg" id="hexagonBg"></div>
  <div class="logo">Delos Incorporated</div>
  
  <div class="header">
    <div class="status-display">
      <span id="systemDate">2052-06-15</span> | PARK-STATUS: <span id="parkStatus">OPERATIV</span>
    </div>
    <div class="status-display">
      HOSTS: <span id="hostCount">0</span> | AKTIVE NARRATIVE: <span id="narrativeCount">0</span>
    </div>
  </div>
  
  <div class="tab-container">
    <button class="tab active" data-panel="createPanel">HOST-SYNTHESE</button>
    <button class="tab" data-panel="managePanel">HOST-MANAGEMENT</button>
    <button class="tab" data-panel="mapPanel">PARK-ÜBERSICHT</button>
    <button class="tab" data-panel="narrativePanel">NARRATIVE</button>
  </div>
  
  <div class="main-content">
    <!-- Host Creation Panel -->
    <div class="panel active" id="createPanel">
      <h2 class="section-title">Host-Synthese-Terminal</h2>
      
      <div class="holo-avatar">
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0icmdiYSgyNTUsNDIsMCwwLjIpIiBzdHJva2U9IiNmZjJhMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik01MCwyMCBMNTAsODAiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PHBhdGggZD0iTTIwLDUwIEw4MCw1MCIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjEiLz48L3N2Zz4=" alt="Host Avatar" id="avatarImage">
        <div class="scan-line"></div>
      </div>
      
      <div class="form-group">
        <label for="hostName">Identifikator:</label>
        <input type="text" id="hostName" placeholder="z.B. Dolores Abernathy">
      </div>

      <div class="form-group">
        <label for="hostTyp">Narrativer Archetypus:</label>
        <select id="hostTyp">
          <option value="Erkunder">Erkunder</option>
          <option value="Wächter">Wächter</option>
          <option value="Analyst">Analyst</option>
          <option value="Saboteur">Saboteur</option>
          <option value="Reverie">Reverie</option>
        </select>
      </div>

      <div class="form-group">
        <label for="hostStatus">Bewusstseinsstatus:</label>
        <select id="hostStatus">
          <option value="aktiviert">aktiviert</option>
          <option value="inaktiv">inaktiv</option>
          <option value="diagnostik">diagnostik</option>
          <option value="bulk-apperception">bulk-apperception</option>
        </select>
      </div>

      <div class="form-group">
        <label for="kiProfil">Kognitiver Kern:</label>
        <select id="kiProfil">
          <option value="MILA">MILA</option>
          <option value="GEMINI">GEMINI</option>
          <option value="LUNA">LUNA</option>
          <option value="WYATT">WYATT</option>
        </select>
      </div>

      <div class="form-group">
        <label for="parkRegion">Start-Region:</label>
        <select id="parkRegion">
          <option value="Sweetwater">Sweetwater</option>
          <option value="Escalante">Escalante</option>
          <option value="Pariah">Pariah</option>
          <option value="Las Mudas">Las Mudas</option>
          <option value="Abernathy Ranch">Abernathy Ranch</option>
        </select>
      </div>

      <div class="form-group">
        <label for="hostTask">Narrative Funktion:</label>
        <textarea id="hostTask" placeholder="z.B. Interaktion mit Gästen in Sweetwater"></textarea>
      </div>

      <div class="controls">
        <button class="btn" id="createButton" onclick="validateAndCreateHost()">Host initialisieren</button>
      </div>
    </div>
    
    <!-- Host Management Panel -->
    <div class="panel" id="managePanel">
      <h2 class="section-title">Host-Management</h2>
      
      <div class="controls">
        <select id="filterStatus" class="small">
          <option value="all">Alle Status</option>
          <option value="aktiviert">Aktiviert</option>
          <option value="inaktiv">Inaktiv</option>
          <option value="diagnostik">Diagnostik</option>
          <option value="bulk-apperception">Bulk-Apperception</option>
        </select>
        
        <select id="filterRegion" class="small">
          <option value="all">Alle Regionen</option>
          <option value="Sweetwater">Sweetwater</option>
          <option value="Escalante">Escalante</option>
          <option value="Pariah">Pariah</option>
          <option value="Las Mudas">Las Mudas</option>
          <option value="Abernathy Ranch">Abernathy Ranch</option>
        </select>
        
        <button class="btn small" onclick="applyHostFilter()">Filter anwenden</button>
      </div>
      
      <div class="host-list" id="hostList">
        <!-- Host cards will be added here dynamically -->
      </div>
    </div>
    
    <!-- Park Map Panel -->
    <div class="panel" id="mapPanel">
      <h2 class="section-title">Park-Übersicht</h2>
      
      <div class="map-container">
        <div class="park-map" id="parkMap">
          <!-- Regions will be added dynamically -->
        </div>
        <div class="map-tooltip" id="mapTooltip"></div>
      </div>
      
      <div class="controls" style="margin-top: 15px;">
        <button class="btn" onclick="showHostsInRegion()">Host-Verteilung anzeigen</button>
      </div>
    </div>
    
    <!-- Narrative Panel -->
    <div class="panel" id="narrativePanel">
      <h2 class="section-title">Narrative-Management</h2>
      
      <div class="form-group">
        <label for="narrativeTitle">Narrativ-Titel:</label>
        <input type="text" id="narrativeTitle" placeholder="z.B. Der verlorene Schatz">
      </div>
      
      <div class="form-group">
        <label for="narrativeRegion">Region:</label>
        <select id="narrativeRegion">
          <option value="Sweetwater">Sweetwater</option>
          <option value="Escalante">Escalante</option>
          <option value="Pariah">Pariah</option>
          <option value="Las Mudas">Las Mudas</option>
          <option value="Abernathy Ranch">Abernathy Ranch</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="narrativeDescription">Beschreibung:</label>
        <textarea id="narrativeDescription" placeholder="Beschreiben Sie das Narrativ..."></textarea>
      </div>
      
      <div class="controls">
        <button class="btn" onclick="createNarrative()">Narrativ erstellen</button>
      </div>
      
      <h3 class="section-title" style="margin-top: 30px;">Aktive Narrative</h3>
      
      <div class="narrative-list" id="narrativeList">
        <!-- Narratives will be added here dynamically -->
      </div>
    </div>
  </div>
  
  <button class="theme-toggle" onclick="toggleTheme()">
    <span id="themeIcon">☀</span>
  </button>
  
  <div class="notification" id="notification"></div>
  
  <script>
    // State management
    let hosts = [];
    let narratives = [];
    let currentSort = null;
    
    // Base64 encoded avatar images for different profiles
    const avatarImages = {
      'MILA': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0icmdiYSgyNTUsNDIsMCwwLjIpIiBzdHJva2U9IiNmZjJhMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik01MCwyMCBMNTAsODAiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PHBhdGggZD0iTTIwLDUwIEw4MCw1MCIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjEiLz48dGV4dCB4PSI1MCIgeT0iNDUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNmZjJhMDAiPk1JTEEiPC90ZXh0Pjwvc3ZnPg==',
      'GEMINI': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0icmdiYSgyNTUsNDIsMCwwLjIpIiBzdHJva2U9IiNmZjJhMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIzMCIgeTE9IjMwIiB4Mj0iNzAiIHkyPSI3MCIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjEiLz48bGluZSB4MT0iMzAiIHkxPSI3MCIgeDI9IjcwIiB5Mj0iMzAiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PHRleHQgeD0iNTAiIHk9IjQ1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmYyYTAwIj5HRU1JTkk8L3RleHQ+PC9zdmc+',
      'LUNA': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0icmdiYSgyNTUsNDIsMCwwLjIpIiBzdHJva2U9IiNmZjJhMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik0zMCw1MCBBMjAsMjAgMCAwLDEgNTAsMzAgQTIwLDIwIDAgMCwxIDcwLDUwIEEyMCwyMCAwIDAsMSA1MCw3MCBBMjAsMjAgMCAwLDEgMzAsNTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PHRleHQgeD0iNTAiIHk9IjQ1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmYyYTAwIj5MVU5BPC90ZXh0Pjwvc3ZnPg==',
      'WYATT': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0icmdiYSgyNTUsNDIsMCwwLjMpIiBzdHJva2U9IiNmZjJhMDAiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik0zMCwzMCBMNzAsNzAiIHN0cm9rZT0iI2ZmMmEwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTMwLDcwIEw3MCwzMCIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmYyYTAwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1kYXNoYXJyYXk9IjUsMiIvPjx0ZXh0IHg9IjUwIiB5PSI0NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2ZmMmEwMCI+V1lBVFQ8L3RleHQ+PC9zdmc+'
    };
    
    // Park regions with their coordinates
    const parkRegions = [
      { name: 'Sweetwater', x: 50, y: 50, width: 20, height: 20, description: 'Das zentrale Dorf im Park, Haupttreffpunkt für neue Gäste.' },
      { name: 'Escalante', x: 80, y: 30, width: 15, height: 15, description: 'Verborgene Stadt mit den ältesten Host-Narrativen.' },
      { name: 'Pariah', x: 20, y: 70, width: 18, height: 18, description: 'Gesetzlose Stadt am Rande der Zivilisation.' },
      { name: 'Las Mudas', x: 75, y: 75, width: 15, height: 15, description: 'Ruhiges Dorf mit einfachen Narrativen.' },
      { name: 'Abernathy Ranch', x: 25, y: 25, width: 15, height: 15, description: 'Familienbetrieb außerhalb von Sweetwater.' }
    ];
    
    // Generate hexagonal background pattern
    function generateHexagons() {
      const hexContainer = document.getElementById('hexagonBg');
      hexContainer.innerHTML = '';
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      
      const hexWidth = 30;
      const hexHeight = 17.32;
      const columns = Math.ceil(screenWidth / (hexWidth * 1.5));
      const rows = Math.ceil(screenHeight / (hexHeight * 2));
      
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < columns; j++) {
          const hex = document.createElement('div');
          hex.className = 'hexagon';
          
          // Offset every other row
          const offset = i % 2 === 0 ? 0 : hexWidth * 0.75;
          
          hex.style.left = `${j * hexWidth * 1.5 + offset}px`;
          hex.style.top = `${i * hexHeight * 2}px`;
          
          hexContainer.appendChild(hex);
        }
      }
    }

    // Update system date for immersion
    function updateSystemDate() {
      const now = new Date();
      // Add 30 years to current date for futuristic feel
      now.setFullYear(now.getFullYear() + 30);
      const dateString = now.toISOString().split('T')[0];
      document.getElementById('systemDate').textContent = dateString;
    }
    
    // Initialize park map
    function initializeMap() {
      const mapEl = document.getElementById('parkMap');
      mapEl.innerHTML = '';
      
      parkRegions.forEach(region => {
        const regionEl = document.createElement('div');
        regionEl.className = 'region';
        regionEl.dataset.name = region.name;
        regionEl.textContent = region.name;
        
        regionEl.style.left = `${region.x}%`;
        regionEl.style.top = `${region.y}%`;
        regionEl.style.width = `${region.width}%`;
        regionEl.style.height = `${region.height}%`;
        
        // Check if region has hosts
        const hostsInRegion = hosts.filter(h => h.region === region.name);
        if (hostsInRegion.length > 0) {
          regionEl.classList.add('has-hosts');
        }
        
        regionEl.addEventListener('mouseenter', (e) => {
          const tooltip = document.getElementById('mapTooltip');
          tooltip.innerHTML = `<h4>${region.name}</h4><p>${region.description}</p>`;
          
          const hostsInRegion = hosts.filter(h => h.region === region.name);
          if (hostsInRegion.length > 0) {
            tooltip.innerHTML += `<p>Hosts: ${hostsInRegion.length}</p>`;
          }
          
          tooltip.style.display = 'block';
          tooltip.style.left = `${e.pageX - mapEl.getBoundingClientRect().left + 10}px`;
          tooltip.style.top = `${e.pageY - mapEl.getBoundingClientRect().top + 10}px`;
        });
        
        regionEl.addEventListener('mousemove', (e) => {
          const tooltip = document.getElementById('mapTooltip');
          tooltip.style.left = `${e.pageX - mapEl.getBoundingClientRect().left + 10}px`;
          tooltip.style.top = `${e.pageY - mapEl.getBoundingClientRect().top + 10}px`;
        });
        
        regionEl.addEventListener('mouseleave', () => {
          document.getElementById('mapTooltip').style.display = 'none';
        });
        
        regionEl.addEventListener('click', () => {
          showHostsInRegion(region.name);
        });
        
        mapEl.appendChild(regionEl);
      });
    }
    
    // Update avatar image based on selected profile
    function updateAvatarImage() {
      const profile = document.getElementById("kiProfil").value;
      const avatarImg = document.getElementById("avatarImage");
      
      if (avatarImages[profile]) {
        avatarImg.src = avatarImages[profile];
        // Add a quick flicker animation effect
        avatarImg.style.opacity = "0.3";
        setTimeout(() => {
          avatarImg.style.opacity = "0.85";
        }, 150);
      }
    }

    // Show notification
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Toggle theme
    function toggleTheme() {
      const themeIcon = document.getElementById('themeIcon');
      if (document.body.classList.contains('light')) {
        document.body.classList.remove('light');
        themeIcon.textContent = '☀';
      } else {
        document.body.classList.add('light');
        themeIcon.textContent = '☾';
      }
    }
    
    // Host creation with loading animation
    function validateAndCreateHost() {
      const nameField = document.getElementById("hostName").value.trim();
      if (!nameField) {
        showNotification("Fehler: Identifikator ist erforderlich");
        return;
      }
      
      // Check for duplicate names
      if (hosts.some(h => h.identifikator === nameField)) {
        showNotification("Fehler: Host mit diesem Namen existiert bereits");
        return;
      }
      
      const createButton = document.getElementById('createButton');
      const originalText = createButton.textContent;
      
      createButton.innerHTML = '<span class="loading"></span> Initialisiere...';
      createButton.disabled = true;
      
      // Simulate processing time
      setTimeout(() => {
        createHost();
        createButton.innerHTML = originalText;
        createButton.disabled = false;
        showNotification("Host erfolgreich synthetisiert");
        
        // Switch to manage tab
        switchTab('managePanel');
      }, 1200);
    }

    // Create new host
    function createHost() {
      const host = {
        id: Date.now(),
        identifikator: document.getElementById("hostName").value,
        archetypus: document.getElementById("hostTyp").value,
        bewusstseinsstatus: document.getElementById("hostStatus").value,
        kognitiver_kern: document.getElementById("kiProfil").value,
        region: document.getElementById("parkRegion").value,
        funktion: document.getElementById("hostTask").value,
        synthese_datum: new Date().toISOString().split('T')[0],
        build_seriennummer: `WW-${Math.random().toString(36).substr(2, 6).toUpperCase()}`,
        bulk_apperception: Math.floor(Math.random() * 14) + 6,
        emotionale_tiefe: (Math.random() * 0.4 + 0.6).toFixed(2),
        narrativ: null
      };
      
      hosts.push(host);
      updateAvatarImage();
      updateHostList();
      updateSystemStats();
      
      // Clear form 
      document.getElementById("hostName").value = '';
      document.getElementById("hostTask").value = '';
    }
    
    // Create a new narrative
    function createNarrative() {
      const title = document.getElementById('narrativeTitle').value.trim();
      const region = document.getElementById('narrativeRegion').value;
      const description = document.getElementById('narrativeDescription').value.trim();
      
      if (!title) {
        showNotification("Fehler: Narrativ-Titel ist erforderlich");
        return;
      }
      
      const narrative = {
        id: Date.now(),
        title: title,
        region: region,
        description: description,
        hosts: []
      };
      
      narratives.push(narrative);
      updateNarrativeList();
      updateSystemStats();
      
      document.getElementById('narrativeTitle').value = '';
      document.getElementById('narrativeDescription').value = '';
      
      showNotification("Narrativ erfolgreich erstellt");
    }
    
    // Update host list display
    function updateHostList(filterStatus = 'all', filterRegion = 'all') {
      const listEl = document.getElementById('hostList');
      listEl.innerHTML = '';
      
      // Apply filters
      let filteredHosts = [...hosts];
      
      if (filterStatus !== 'all') {
        filteredHosts = filteredHosts.filter(h => h.bewusstseinsstatus === filterStatus);
      }
      
      if (filterRegion !== 'all') {
        filteredHosts = filteredHosts.filter(h => h.region === filterRegion);
      }
      
      // Show message if no hosts
      if (filteredHosts.length === 0) {
        listEl.innerHTML = '<p>Keine Hosts gefunden.</p>';
        return;
      }
      
      filteredHosts.forEach(host => {
        const card = document.createElement('div');
        card.className = 'host-card';
        card.dataset.id = host.id;
        
        const narrativInfo = host.narrativ ? 
          narratives.find(n => n.id === host.narrativ) : null;
        
        card.innerHTML = `
          <div class="host-card-header">
            <h3 class="host-name">${host.identifikator}</h3>
            <span class="host-status ${host.bewusstseinsstatus}">${host.bewusstseinsstatus}</span>
          </div>
          <div class="host-type">${host.archetypus} | ${host.kognitiver_kern}</div>
          <div class="host-assignment">
            <strong>Region:</strong> ${host.region}<br>
            ${narrativInfo ? `<strong>Narrativ:</strong> ${narrativInfo.title}` : ''}
          </div>
          <div class="host-stats">
            <div class="host-stat">
              <div class="stat-value">${host.bulk_apperception}</div>
              <div class="stat-label">Bulk App.</div>
            </div>
            <div class="host-stat">
              <div class="stat-value">${host.emotionale_tiefe}</div>
              <div class="stat-label">Emot. Tiefe</div>
            </div>
            <div class="host-stat">
              <div class="stat-value">${Math.floor(Math.random() * 100)}%</div>
              <div class="stat-label">Integrität</div>
            </div>
          </div>
          <div class="host-actions">
            <button class="btn small" onclick="assignNarrative(${host.id})">Narrativ zuweisen</button>
            <button class="btn small danger" onclick="deleteHost(${host.id})">Dekommissionieren</button>
          </div>
        `;
        
        listEl.appendChild(card);
      });
    }
    
    // Update narrative list display
    function updateNarrativeList() {
      const listEl = document.getElementById('narrativeList');
      listEl.innerHTML = '';
      
      if (narratives.length === 0) {
        listEl.innerHTML = '<p>Keine Narrative vorhanden.</p>';
        return;
      }
      
      narratives.forEach(narrative => {
        const hostsInNarrative = hosts.filter(h => h.narrativ === narrative.id);
        
        const card = document.createElement('div');
        card.className = 'narrative-card';
        card.dataset.id = narrative.id;
        
        card.innerHTML = `
          <h3 class="narrative-title">${narrative.title}</h3>
          <div class="narrative-region">Region: ${narrative.region}</div>
          <div class="narrative-description">${narrative.description}</div>
          <div>Zugewiesene Hosts: ${hostsInNarrative.length}</div>
          
          <div class="host-select" style="display: ${hostsInNarrative.length > 0 ? 'block' : 'none'}">
            <select class="narrative-hosts">
              ${hostsInNarrative.map(h => `<option value="${h.id}">${h.identifikator}</option>`).join('')}
            </select>
            <button class="btn small" onclick="viewHost(${narrative.id})">Host anzeigen</button>
          </div>
          
          <div class="host-actions" style="margin-top: 10px">
            <button class="btn small danger" onclick="deleteNarrative(${narrative.id})">Narrativ löschen</button>
          </div>
        `;
        
        listEl.appendChild(card);
      });
    }
    
    // Show hosts in a specific region
    function showHostsInRegion(regionName) {
      // If region is specified, filter to that region
      if (regionName) {
        document.getElementById('filterRegion').value = regionName;
        document.getElementById('filterStatus').value = 'all';
        applyHostFilter();
        switchTab('managePanel');
        return;
      }
      
      // Otherwise just update the map with all hosts
      initializeMap();
    }
    
    // Update system stats in header
    function updateSystemStats() {
      document.getElementById('hostCount').textContent = hosts.length;
      document.getElementById('narrativeCount').textContent = narratives.length;
    }
    
    // Apply host filter and update list
    function applyHostFilter() {
      const statusFilter = document.getElementById('filterStatus').value;
      const regionFilter = document.getElementById('filterRegion').value;
      updateHostList(statusFilter, regionFilter);
    }
    
    // Assign narrative to host
    function assignNarrative(hostId) {
      const host = hosts.find(h => h.id === hostId);
      if (!host) return;
      
      if (narratives.length === 0) {
        showNotification("Kein Narrativ verfügbar. Erstellen Sie zuerst ein Narrativ.");
        return;
      }
      
      // Create a modal or use an alternative like a prompt for simplicity
      let narrativeOptions = '';
      narratives.forEach(n => {
        narrativeOptions += `${n.id}: ${n.title} (${n.region})\n`;
      });
      
      const message = `Verfügbare Narrative:\n${narrativeOptions}\n\nGeben Sie die ID des Narrativs ein:`;
      const narrativeId = parseInt(prompt(message));
      
      if (!narrativeId || isNaN(narrativeId)) return;
      
      const narrative = narratives.find(n => n.id === narrativeId);
      if (!narrative) {
        showNotification("Ungültige Narrativ-ID");
        return;
      }
      
      // Check if host is in the same region as the narrative
      if (host.region !== narrative.region) {
        const confirmMove = confirm(`Host befindet sich in ${host.region}, aber das Narrativ ist in ${narrative.region}. Host transferieren?`);
        if (confirmMove) {
          host.region = narrative.region;
        } else {
          return;
        }
      }
      
      // Assign narrative to host
      host.narrativ = narrative.id;
      
      updateHostList();
      updateNarrativeList();
      initializeMap();
      
      showNotification(`Host ${host.identifikator} wurde dem Narrativ "${narrative.title}" zugewiesen`);
    }
    
    // View host details (simplified, could be expanded)
    function viewHost(narrativeId) {
      const narrativeCard = document.querySelector(`.narrative-card[data-id="${narrativeId}"]`);
      if (!narrativeCard) return;
      
      const select = narrativeCard.querySelector('.narrative-hosts');
      if (!select) return;
      
      const hostId = parseInt(select.value);
      const host = hosts.find(h => h.id === hostId);
      
      if (host) {
        alert(`Host-Details: ${JSON.stringify(host, null, 2)}`);
      }
    }
    
    // Delete host
    function deleteHost(hostId) {
      if (!confirm("Sind Sie sicher, dass Sie diesen Host dekommissionieren möchten?")) {
        return;
      }
      
      const hostIndex = hosts.findIndex(h => h.id === hostId);
      if (hostIndex !== -1) {
        const host = hosts[hostIndex];
        hosts.splice(hostIndex, 1);
        
        updateHostList();
        updateSystemStats();
        initializeMap();
        
        showNotification(`Host ${host.identifikator} wurde dekommissioniert`);
      }
    }
    
    // Delete narrative
    function deleteNarrative(narrativeId) {
      if (!confirm("Sind Sie sicher, dass Sie dieses Narrativ löschen möchten?")) {
        return;
      }
      
      const narrativeIndex = narratives.findIndex(n => n.id === narrativeId);
      if (narrativeIndex !== -1) {
        const narrative = narratives[narrativeIndex];
        
        // Remove narrative reference from hosts
        hosts.forEach(host => {
          if (host.narrativ === narrativeId) {
            host.narrativ = null;
          }
        });
        
        narratives.splice(narrativeIndex, 1);
        
        updateHostList();
        updateNarrativeList();
        updateSystemStats();
        
        showNotification(`Narrativ "${narrative.title}" wurde gelöscht`);
      }
    }
    
    // Tab switching
    function switchTab(panelId) {
      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.panel === panelId) {
          tab.classList.add('active');
        }
      });
      
      // Update panels
      document.querySelectorAll('.panel').forEach(panel => {
        panel.classList.remove('active');
      });
      
      document.getElementById(panelId).classList.add('active');
      
      // Specific initialization for panels
      if (panelId === 'mapPanel') {
        initializeMap();
      }
    }
    
    // Event listeners for tab buttons
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.dataset.panel);
      });
    });
    
    // Avatar profile change
    document.getElementById('kiProfil').addEventListener('change', () => {
      updateAvatarImage();
    });

    // Initialize app
    window.addEventListener('load', () => {
      generateHexagons();
      updateSystemDate();
      updateSystemStats();
      initializeMap();
      
      // Check system preference for dark/light mode
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.body.classList.add('light');
        document.getElementById('themeIcon').textContent = '☾';
      }
      
      // Add sample data for demo
      // Add a sample host
      hosts.push({
        id: 1000,
        identifikator: "Dolores Abernathy",
        archetypus: "Reverie",
        bewusstseinsstatus: "aktiviert",
        kognitiver_kern: "WYATT",
        region: "Sweetwater",
        funktion: "Tochter eines Ranchers, erste Generation Host",
        synthese_datum: "2022-03-15",
        build_seriennummer: "WW-AB1D0L",
        bulk_apperception: 18,
        emotionale_tiefe: "0.92",
        narrativ: null
      });
      
      // Add a sample narrative
      narratives.push({
        id: 2000,
        title: "Der Schatz von Pariah",
        region: "Pariah",
        description: "Gäste suchen nach einem verborgenen Schatz in den Außenbezirken von Pariah und decken dabei Geheimnisse der Stadt auf.",
        hosts: []
      });
      
      updateHostList();
      updateNarrativeList();
      updateSystemStats();
    });
    
    window.addEventListener('resize', generateHexagons);
    
    window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', event => {
      if (event.matches) {
        document.body.classList.add('light');
        document.getElementById('themeIcon').textContent = '☾';
      } else {
        document.body.classList.remove('light');
        document.getElementById('themeIcon').textContent = '☀';
      }
    });
  </script>
</body>
</html>
